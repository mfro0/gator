
X11=/usr/X11R6/

X11CFLAGS=@X_CFLAGS@
X11LIBS=@X_PRE_LIBS@ @X_LIBS@ @X_EXTRA_LIBS@ -lX11 -lXext -lXv

DEFINES=

CC=gcc -pipe -g $(INCLUDES) $(DEFINES)

SRCS=xv.c frequencies.c xmisc.c string_cache.c v4l.c formats.c ffmpeg.c \
	alsa.c packet_stream.c linux.c

#LIBS=-lm -ldl $(X11LIBS) @FFMPEG_LIBS@
LIBS=$(X11LIBS) @LIBS@ @FFMPEG_LIBS@

TCLLIBS=-ltcl8.3
TKLIBS=-ltk8.3


all: avview_shell

test: avview_shell
	sync
	bash -c 'export DISPLAY=:0.0; ./avview.scp control=inspire:0.0'

#	./read_pci.scp

avview_shell: $(SRCS) main.c
	$(CC) -O2 $(X11CFLAGS) @FFMPEG_CFLAGS@ $(SRCS) $(TCLLIBS) $(TKLIBS) $(LIBS) main.c -o avview_shell

avview_shell.static: $(SRCS) main.c
	$(CC) -static $(X11CFLAGS) @FFMPEG_CFLAGS@ $(SRCS) $(TCLLIBS) $(LIBS) main.c -lm -dl -o avview_shell.static
	strip avview_shell.static
	
write_test: write_test.c
	$(CC) write_test.c -o write_test	
	
tarball:
	(cd .. ; tar cvf - avview/*.scp avview/*.[c,h] avview/Makefile.in avview/configure.in avview/configure avview/config.h.in avview/README* | gzip - ) > avview.tgz

clean:
	rm -f *.o *.bck *.bak core
